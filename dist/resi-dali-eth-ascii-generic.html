<!--
 Copyright (c) 2022 Renato Rossi
 All rights reserved.
 node-red-contrib-resi-dali-ascii-gateway - MIT License

 @author <a href="mailto:renatrossi@google.com">Renato Rossi</a>
-->
<script type="text/javascript">
    RED.nodes.registerType('dali-generic', {
      category: 'RESI DALI ETH ASCII Gateway',
      color: '#E9967A',
      defaults: {
        name: {value: ''},
        server: {type: 'resi-dali-eth-ascii-client', required: true}
      },
      inputs: 1,
      outputs: 1,
      align: "right",
      icon: 'modbus.png',
      align: 'right',
      paletteLabel: 'dali-generic',
      label: function () {
        return this.name || 'DALI Lamp Level'
      }
    })
  </script>

<script type="text/html" data-template-name="dali-generic">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-server"><i class="icon-bookmark"></i> <span data-i18n="dali-contrib.label.server"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <hr>
</script>

<script type="text/x-red" data-help-name="dali-generic">
  <p>
      Generic modbus ascii command.
  </p>

  <p>Modbus TCP/Serial node triggered with <strong>msg.payload</strong> to write.</p>
  <p>Connects to a Modbus TCP or serial to write coils/registers at each incoming msg.</p>
  <p>
      <h4>DALI 1.0 COMMAND FOR LAMP</h4>
      <style type="text/css">
        .tg  {border-collapse:collapse;border-spacing:0;}
        .tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
          overflow:hidden;padding:10px 5px;word-break:normal;}
        .tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
          font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
        .tg .tg-88oy{font-size:xx-small;text-align:center;vertical-align:top}
        .tg .tg-0lax{text-align:left;vertical-align:top}
        </style>
        <table class="tg">
        <thead>
          <tr>
            <th class="tg-88oy" colspan="7">Available DALI commands</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="tg-0lax">OFF</td>
            <td class="tg-0lax">OF UP</td>
            <td class="tg-0lax">UP DOWN</td>
            <td class="tg-0lax">DO STEP UP</td>
            <td class="tg-0lax">SUP STEP DOWN</td>
            <td class="tg-0lax">SDO RECALL MAX LEVEL</td>
            <td class="tg-0lax">RMAXL RECALL MIN LEVEL</td>
          </tr>
          <tr>
            <td class="tg-0lax">RMINL STEP DOWN AND OFF</td>
            <td class="tg-0lax">SDOO ON AND STEP UP</td>
            <td class="tg-0lax">OSUP ENABLE DAPC SEQUENCE</td>
            <td class="tg-0lax">EDAPCS GOTO LAST ACTIVE LEVEL</td>
            <td class="tg-0lax">GLAL</td>
            <td class="tg-0lax">---</td>
            <td class="tg-0lax">---</td>
          </tr>
        </tbody>
        </table>

        Available DALI commands which are repeated twice within 100ms: 
        RESET,RESET-STORE ACTUAL LEVEL IN DTR,SALD-STORE DTR AS MAX LEVEL,SDMAXL-STORE DTR AS MIN LEVEL,
        SDMINL-STORE DTR AS SYSTEM FAILURE LEVEL,SDSFL-STORE DTR AS POWER ON LEVEL,SDPOL-STORE DTR AS FADE TIME,
        SDFT-STORE DTR AS FADE RATE,SDFR-STIORE DTR AS SHORT ADDRESS,SDSA-ENABLE WRITE MEMORY,EWM        
        <table class="tg">
          <thead>
            <tr>
              <th class="tg-88oy" colspan="7">Available DALI commands which are repeated twice within 100ms</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tg-0lax">RESET</td>
              <td class="tg-0lax">RESET-STORE ACTUAL LEVEL IN DTR</td>
              <td class="tg-0lax">SALD-STORE DTR AS MAX LEVEL</td>
              <td class="tg-0lax">SDMAXL-STORE DTR AS MIN LEVELP</td>
              <td class="tg-0lax">SDMINL-STORE DTR AS SYSTEM FAILURE LEVEL</td>
              <td class="tg-0lax">SDSFL-STORE DTR AS POWER ON LEVEL</td>
              <td class="tg-0lax">SDPOL-STORE DTR AS FADE TIME</td>
            </tr>
            <tr>
              <td class="tg-0lax">SDFT-STORE DTR AS FADE RATE</td>
              <td class="tg-0lax">SDFR-STIORE DTR AS SHORT ADDRESS</td>
              <td class="tg-0lax">SDSA-ENABLE WRITE MEMORY</td>
              <td class="tg-0lax">EWM</td>
              <td class="tg-0lax">---</td>
              <td class="tg-0lax">---</td>
              <td class="tg-0lax">---</td>
            </tr>
          </tbody>
          </table>

      <ul>
        <li>FC 5: Force Single Coil</li>
        <li>FC 6: Preset Single Register</li>
        <li>FC 15: Force Multiple Coils</li>
        <li>FC 16: Preset Multiple Registers</li>
      </ul>
  </p>
  <p>
      Choose a function code (FC) from the dropdown menu,
      select the coil/register start address (0:65535) and the quantity to write.
      Choose or edit the Modbus TCP/serial server configuration to specify the server to connect to.
  </p>

  <p>Unit-Id (0..255 tcp | 0..247 serial) - leave empty, otherwise it overrides the default Unit-ID of client
   config</p>

  <p>
      For FC 5, <strong>msg.payload</strong> must be a value of 1 or 0 or true or false.
      For FC 15, <strong>msg.payload</strong> must be an array[] of comma separated values true or false each.
      For FC 6, <strong>msg.payload</strong> must be a single value between 0:65535.
      For FC 16, <strong>msg.payload</strong> must be an array[] of comma separated values between 0:65535 each.
  </p>

   <p>Output 1: all given data, modbus response Buffer, input message</p>
   <p>Output 2: modbus response Buffer, all given data, input message</p>

</script>


