<!--
 Copyright (c) 2022 Renato Rossi
 All rights reserved.
 node-red-contrib-resi-dali-ascii-gateway - MIT License

 @author <a href="mailto:renatrossi@google.com">Renato Rossi</a>
-->
<script type="text/javascript">
    RED.nodes.registerType('dali-generic', {
      category: 'RESI DALI ETH ASCII Gateway',
      color: '#E9967A',
      defaults: {
        name: {value: ''},
        server: {type: 'resi-dali-eth-ascii-client', required: true}
      },
      inputs: 1,
      outputs: 1,
      align: "right",
      icon: 'modbus.png',
      align: 'right',
      paletteLabel: 'dali-generic',
      label: function () {
        return this.name || 'DALI Lamp Level'
      }
    })
  </script>

<script type="text/html" data-template-name="dali-generic">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-server"><i class="icon-bookmark"></i> <span data-i18n="dali-contrib.label.server"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <hr>
</script>

<script type="text/x-red" data-help-name="dali-generic">
  <style type="text/css">
    .tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
    .tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
      font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
    .tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
      font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
    .tg .tg-lap0{font-size:100%;text-align:center;vertical-align:top}
    .tg .tg-5qt9{font-size:small;text-align:left;vertical-align:top}
    .tg .tg-0lax{text-align:left;vertical-align:top}
    </style>
  <p>
      Generic modbus ascii command.
  </p>

  <p>RESI DALI ETH ASCII node triggered with <strong>msg.payload</strong> to write.</p>
  <p>Connects to a RESI DALI ETH ASCII to manage DALI LAMP\Device at each incoming msg.</p>
  <p>
      <h4>DALI BUS ERROR</h4>
      <p>
        <h5>Description</h5>
          Shows the status of the DALI bus.<br>
          BusErrDec,BusErrHex:<br>
          =0:DALI bus is OK and fully functional
          =1:DALI bus error,<br>
          short circuit on DALI line, overload on DALI line or no DALI power supply
      </p>
      <table class="tg" width="100%">
        <thead>
          <tr>
            <th class="tg-lap0" width="20%">&nbsp;</th>
            <th class="tg-lap0" width="30%">Available DALI commands</th>
            <th class="tg-lap0" width="50%">Note</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row" class="tg-5qt9"><strong>ASCII READ COMMAND</strong></th>
            <td class="tg-5qt9"><code>
              #DALI BUS ERROR&lt;CR&gt;<br>
              #DBERR&lt;CR&gt;<br>
              Result:#DBERR:<br>
              &lt;BusErrDec&gt;,&lt;BusErrHex&gt;&lt;CR&gt;
              <code>
            </td>
            <td class="tg-5qt9">&nbsp;</td>
          </tr>   
          <tr>
            <th scope="row" class="tg-5qt9"><strong>TX</strong></th>
            <td class="tg-5qt9"><code>
              #DALI BUS ERROR&lt;CR&gt;
              <code>
            </td>
            <td class="tg-5qt9">&nbsp;</td>
          </tr>   
          <tr>
            <th scope="row" class="tg-5qt9"><strong>RX</strong></th>
            <td class="tg-5qt9"><code>
              #255,DBERR:0,0x0&lt;CR&gt;
              <code>
            </td>
            <td class="tg-5qt9">&nbsp;</td>
          </tr>        
        </tbody>
      </table>
  </p>
  <p>
      <h4>DALI 1.0 COMMAND FOR LAMP</h4>
        <table class="tg">
        <thead>
          <tr>
            <th class="tg-lap0" colspan="7">Available DALI commands</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="tg-5qt9">OFF</td>
            <td class="tg-5qt9">OF UP</td>
            <td class="tg-5qt9">UP DOWN</td>
            <td class="tg-5qt9">DO STEP UP</td>
            <td class="tg-5qt9">SUP STEP DOWN</td>
            <td class="tg-5qt9">SDO RECALL MAX LEVEL</td>
            <td class="tg-5qt9">RMAXL RECALL MIN LEVEL</td>
          </tr>
          <tr>
            <td class="tg-5qt9">RMINL STEP DOWN AND OFF</td>
            <td class="tg-5qt9">SDOO ON AND STEP UP</td>
            <td class="tg-5qt9">OSUP ENABLE DAPC SEQUENCE</td>
            <td class="tg-5qt9">EDAPCS GOTO LAST ACTIVE LEVEL</td>
            <td class="tg-5qt9">GLAL</td>
            <td class="tg-5qt9">---</td>
            <td class="tg-5qt9">---</td>
          </tr>
        </tbody>
        </table>

        <table class="tg">
          <thead>
            <tr>
              <th class="tg-lap0" colspan="7">Available DALI commands which are repeated twice within 100ms</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tg-5qt9">RESET</td>
              <td class="tg-5qt9">RESET-STORE ACTUAL LEVEL IN DTR</td>
              <td class="tg-5qt9">SALD-STORE DTR AS MAX LEVEL</td>
              <td class="tg-5qt9">SDMAXL-STORE DTR AS MIN LEVELP</td>
              <td class="tg-5qt9">SDMINL-STORE DTR AS SYSTEM FAILURE LEVEL</td>
              <td class="tg-5qt9">SDSFL-STORE DTR AS POWER ON LEVEL</td>
              <td class="tg-5qt9">SDPOL-STORE DTR AS FADE TIME</td>
            </tr>
            <tr>
              <td class="tg-5qt9">SDFT-STORE DTR AS FADE RATE</td>
              <td class="tg-5qt9">SDFR-STIORE DTR AS SHORT ADDRESS</td>
              <td class="tg-5qt9">SDSA-ENABLE WRITE MEMORY</td>
              <td class="tg-5qt9">EWM</td>
              <td class="tg-5qt9">---</td>
              <td class="tg-5qt9">---</td>
              <td class="tg-5qt9">---</td>
            </tr>
          </tbody>
        </table>

        <table class="tg">
          <thead>
            <tr>
              <th class="tg-lap0" colspan="7">Available DALI commands for queries</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tg-5qt9">QUERY STATUS</td>
              <td class="tg-5qt9">QS QUERY CONTROL GEAR</td>
              <td class="tg-5qt9">QCG QUERY LAMP FAILURE</td>
              <td class="tg-5qt9">QLF QUERY LAMP POWER ON</td>
              <td class="tg-5qt9">QLPO QUERY LIMIT ERROR</td>
              <td class="tg-5qt9">QLE QUERY RESET STATE</td>
              <td class="tg-5qt9">QRS QUERY MISSING SHORT ADDRESS</td>
            </tr>
            <tr>
              <td class="tg-5qt9">QMSA QUERY VERSION NUMBER</td>
              <td class="tg-5qt9">QVN QUERY CONTENT DTR</td>
              <td class="tg-5qt9">QCD QUERY DEVICE TYPE</td>
              <td class="tg-5qt9">QDT QUERY PHYSICAL MINIMUM LEVEL</td>
              <td class="tg-5qt9">QPMINL QUERY POWER FAILURE</td>
              <td class="tg-5qt9">QPF QUERY CONTENT DTR1</td>
              <td class="tg-5qt9">QCD1 QUERY CONTENT DTR2</td>
            </tr>
            <tr>
              <td class="tg-5qt9">QCD2 QUERY ACTUAL LEVEL</td>
              <td class="tg-5qt9">QAL QUERY MAX LEVEL</td>
              <td class="tg-5qt9">QMAXL QUERY MIN LEVEL</td>
              <td class="tg-5qt9">QMINL QUERY POWER ON LEVEL</td>
              <td class="tg-5qt9">QPOL QUERY SYSTEM FAILURE LEVEL</td>
              <td class="tg-5qt9">QSFL QUERY FADE TIME FADE RATE</td>
              <td class="tg-5qt9">QFTFR QUERY GROUPS 0-7</td>
            </tr>
            <tr>
              <td class="tg-5qt9">QG07 QUERY GROUPS 8-15</td>
              <td class="tg-5qt9">QG815 QUERY RANDOM ADDRESS H</td>
              <td class="tg-5qt9">QRAH QUERY RANDOM ADDRESS M</td>
              <td class="tg-5qt9">QRAM QUERY RANDOM ADDRESS L</td>
              <td class="tg-5qt9">QRAL READ MEMORY LOCATION</td>
              <td class="tg-5qt9">RML QUERY EXTENDED VERSION NUMBER</td>
              <td class="tg-5qt9">QEVN</td>
            </tr>
          </tbody>
        </table>
  </p>
  <p>
      Choose a function code (FC) from the dropdown menu,
      select the coil/register start address (0:65535) and the quantity to write.
      Choose or edit the Modbus TCP/serial server configuration to specify the server to connect to.
  </p>

  <p>Unit-Id (0..255 tcp | 0..247 serial) - leave empty, otherwise it overrides the default Unit-ID of client
   config</p>

  <p>
      For FC 5, <strong>msg.payload</strong> must be a value of 1 or 0 or true or false.
      For FC 15, <strong>msg.payload</strong> must be an array[] of comma separated values true or false each.
      For FC 6, <strong>msg.payload</strong> must be a single value between 0:65535.
      For FC 16, <strong>msg.payload</strong> must be an array[] of comma separated values between 0:65535 each.
  </p>

   <p>Output 1: all given data, modbus response Buffer, input message</p>
   <p>Output 2: modbus response Buffer, all given data, input message</p>

</script>


